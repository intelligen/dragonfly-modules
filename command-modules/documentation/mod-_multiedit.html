<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Command-module for cursor movement and editing &mdash; Dragonfly-modules v0.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '',
          VERSION:     '0.1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="contents.html" />
    <link rel="index" title="Global index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Dragonfly-modules v0.1 documentation" href="index.html" />
    <link rel="next" title="Command-module for taskbar and icon tray access" href="mod-_taskbar.html" />
    <link rel="prev" title="Command-module for moving and controlling windows" href="mod-_winctrl.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="mod-_taskbar.html" title="Command-module for taskbar and icon tray access"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mod-_winctrl.html" title="Command-module for moving and controlling windows"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Dragonfly-modules v0.1 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  
  <div class="section" id="command-module-for-cursor-movement-and-editing">
<h1>Command-module for cursor movement and <strong>editing</strong><a class="headerlink" href="#command-module-for-cursor-movement-and-editing" title="Permalink to this headline">¶</a></h1>
<p>This module allows the user to control the cursor and
efficiently perform multiple text editing actions within a
single phrase.</p>
<div class="section" id="example-commands">
<h2>Example commands<a class="headerlink" href="#example-commands" title="Permalink to this headline">¶</a></h2>
<p><em>Note the &#8220;/&#8221; characters in the examples below are simply
to help the reader see the different parts of each voice
command.  They are not present in the actual command and
should not be spoken.</em></p>
<dl class="docutils">
<dt>Example: <strong>&#8220;up 4 / down 1 page / home / space 2&#8221;</strong></dt>
<dd>This command will move the cursor up 4 lines, down 1 page,
move to the beginning of the line, and then insert 2 spaces.</dd>
<dt>Example: <strong>&#8220;left 7 words / backspace 3 / insert hello Cap world&#8221;</strong></dt>
<dd>This command will move the cursor left 7 words, then delete
the 3 characters before the cursor, and finally insert
the text &#8220;hello World&#8221;.</dd>
<dt>Example: <strong>&#8220;home / space 4 / down / 43 times&#8221;</strong></dt>
<dd>This command will insert 4 spaces at the beginning of
this and the next 42 lines.  The final &#8220;43 times&#8221;
repeats everything in front of it that many times.</dd>
</dl>
</div>
<div class="section" id="module-source-code">
<h2>Module source code<a class="headerlink" href="#module-source-code" title="Permalink to this headline">¶</a></h2>
<p>The most current version of this module can be downloaded from the <a class="reference external" href="http://dragonfly-modules.googlecode.com/svn/trunk/command-modules/_multiedit.py">repository here</a>.</p>
<table class="highlighttable"><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre></td><td class="code"><div class="highlight"><pre><span class="c">#</span>
<span class="c"># This file is a command-module for Dragonfly.</span>
<span class="c"># (c) Copyright 2008 by Christo Butcher</span>
<span class="c"># Licensed under the LGPL, see &lt;http://www.gnu.org/licenses/&gt;</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Command-module for cursor movement and **editing**</span>
<span class="sd">============================================================================</span>

<span class="sd">This module allows the user to control the cursor and</span>
<span class="sd">efficiently perform multiple text editing actions within a</span>
<span class="sd">single phrase.</span>


<span class="sd">Example commands</span>
<span class="sd">----------------------------------------------------------------------------</span>

<span class="sd">*Note the &quot;/&quot; characters in the examples below are simply</span>
<span class="sd">to help the reader see the different parts of each voice</span>
<span class="sd">command.  They are not present in the actual command and</span>
<span class="sd">should not be spoken.*</span>

<span class="sd">Example: **&quot;up 4 / down 1 page / home / space 2&quot;**</span>
<span class="sd">   This command will move the cursor up 4 lines, down 1 page,</span>
<span class="sd">   move to the beginning of the line, and then insert 2 spaces.</span>

<span class="sd">Example: **&quot;left 7 words / backspace 3 / insert hello Cap world&quot;**</span>
<span class="sd">   This command will move the cursor left 7 words, then delete</span>
<span class="sd">   the 3 characters before the cursor, and finally insert</span>
<span class="sd">   the text &quot;hello World&quot;.</span>

<span class="sd">Example: **&quot;home / space 4 / down / 43 times&quot;**</span>
<span class="sd">   This command will insert 4 spaces at the beginning of</span>
<span class="sd">   this and the next 42 lines.  The final &quot;43 times&quot;</span>
<span class="sd">   repeats everything in front of it that many times.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="c">#---------------------------------------------------------------------------</span>

<span class="kn">from</span> <span class="nn">dragonfly.all</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Grammar</span><span class="p">,</span> <span class="n">CompoundRule</span><span class="p">,</span> <span class="n">MappingRule</span><span class="p">,</span>
                           <span class="n">Dictation</span><span class="p">,</span> <span class="n">RuleRef</span><span class="p">,</span> <span class="n">Repetition</span><span class="p">,</span>
                           <span class="n">Key</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                           <span class="n">Config</span><span class="p">,</span> <span class="n">Section</span><span class="p">,</span> <span class="n">Item</span><span class="p">)</span>


<span class="c">#---------------------------------------------------------------------------</span>
<span class="c"># Here we define the keystroke rule.</span>

<span class="c"># This rule maps spoken-forms to actions.  Some of these</span>
<span class="c">#  include special elements like the number with name &quot;n&quot;</span>
<span class="c">#  or the dictation with name &quot;text&quot;.  This rule is not</span>
<span class="c">#  exported, but is referenced by other elements later on.</span>
<span class="c">#  It is derived from MappingRule, so that its &quot;value&quot; when</span>
<span class="c">#  processing a recognition will be the right side of the</span>
<span class="c">#  mapping: an action.</span>
<span class="k">class</span> <span class="nc">KeystrokeRule</span><span class="p">(</span><span class="n">MappingRule</span><span class="p">):</span>

    <span class="n">exported</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">mapping</span>  <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;up [&lt;n&gt;]&quot;</span><span class="p">:</span>                         <span class="n">Key</span><span class="p">(</span><span class="s">&quot;up:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;down [&lt;n&gt;]&quot;</span><span class="p">:</span>                       <span class="n">Key</span><span class="p">(</span><span class="s">&quot;down:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;left [&lt;n&gt;]&quot;</span><span class="p">:</span>                       <span class="n">Key</span><span class="p">(</span><span class="s">&quot;left:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;right [&lt;n&gt;]&quot;</span><span class="p">:</span>                      <span class="n">Key</span><span class="p">(</span><span class="s">&quot;right:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;page up [&lt;n&gt;]&quot;</span><span class="p">:</span>                    <span class="n">Key</span><span class="p">(</span><span class="s">&quot;pgup:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;page down [&lt;n&gt;]&quot;</span><span class="p">:</span>                  <span class="n">Key</span><span class="p">(</span><span class="s">&quot;pgdown:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;up &lt;n&gt; (page | pages)&quot;</span><span class="p">:</span>            <span class="n">Key</span><span class="p">(</span><span class="s">&quot;pgup:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;down &lt;n&gt; (page | pages)&quot;</span><span class="p">:</span>          <span class="n">Key</span><span class="p">(</span><span class="s">&quot;pgdown:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;left &lt;n&gt; (word | words)&quot;</span><span class="p">:</span>          <span class="n">Key</span><span class="p">(</span><span class="s">&quot;c-left:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;right &lt;n&gt; (word | words)&quot;</span><span class="p">:</span>         <span class="n">Key</span><span class="p">(</span><span class="s">&quot;c-right:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;home&quot;</span><span class="p">:</span>                             <span class="n">Key</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">),</span>
                <span class="s">&quot;end&quot;</span><span class="p">:</span>                              <span class="n">Key</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">),</span>
                <span class="s">&quot;doc home&quot;</span><span class="p">:</span>                         <span class="n">Key</span><span class="p">(</span><span class="s">&quot;c-home&quot;</span><span class="p">),</span>
                <span class="s">&quot;doc end&quot;</span><span class="p">:</span>                          <span class="n">Key</span><span class="p">(</span><span class="s">&quot;c-end&quot;</span><span class="p">),</span>

                <span class="s">&quot;space [&lt;n&gt;]&quot;</span><span class="p">:</span>                      <span class="n">Key</span><span class="p">(</span><span class="s">&quot;space:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;enter [&lt;n&gt;]&quot;</span><span class="p">:</span>                      <span class="n">Key</span><span class="p">(</span><span class="s">&quot;enter:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;delete [&lt;n&gt;]&quot;</span><span class="p">:</span>                     <span class="n">Key</span><span class="p">(</span><span class="s">&quot;del:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="s">&quot;delete [&lt;n&gt; | this] (line|lines)&quot;</span><span class="p">:</span> <span class="n">Key</span><span class="p">(</span><span class="s">&quot;home, s-down:</span><span class="si">%(n)d</span><span class="s">, del&quot;</span><span class="p">),</span>
                <span class="s">&quot;backspace [&lt;n&gt;]&quot;</span><span class="p">:</span>                  <span class="n">Key</span><span class="p">(</span><span class="s">&quot;backspace:</span><span class="si">%(n)d</span><span class="s">&quot;</span><span class="p">),</span>

                <span class="s">&quot;insert &lt;text&gt;&quot;</span><span class="p">:</span>                    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(text)s</span><span class="s">&quot;</span><span class="p">),</span>
               <span class="p">}</span>
    <span class="n">extras</span>   <span class="o">=</span> <span class="p">[</span>
                <span class="n">Integer</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">100</span><span class="p">),</span>
                <span class="n">Dictation</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">),</span>
               <span class="p">]</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;n&quot;</span><span class="p">:</span> <span class="mf">1</span><span class="p">,</span>
               <span class="p">}</span>

<span class="c">#---------------------------------------------------------------------------</span>
<span class="c"># Here we create an element which is the sequence of keystrokes.</span>

<span class="c"># First we create an element that references the keystroke rule.</span>
<span class="n">keystroke</span> <span class="o">=</span> <span class="n">RuleRef</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">KeystrokeRule</span><span class="p">())</span>

<span class="c"># Second we create a repetition of keystroke elements.</span>
<span class="c">#  This element will match anywhere between 1 and 16 repetitions</span>
<span class="c">#  of the keystroke elements.  Note that we give this element</span>
<span class="c">#  the name &quot;sequence&quot; so that it can be used as an extra in</span>
<span class="c">#  the rule definition below.</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="n">Repetition</span><span class="p">(</span><span class="n">keystroke</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">16</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;sequence&quot;</span><span class="p">)</span>


<span class="c">#---------------------------------------------------------------------------</span>
<span class="c"># Here we define the top-level rule which the user can say.</span>

<span class="k">class</span> <span class="nc">RepeatRule</span><span class="p">(</span><span class="n">CompoundRule</span><span class="p">):</span>

    <span class="c"># Here we define this rule&#39;s spoken-form and special elements.</span>
    <span class="n">spec</span>     <span class="o">=</span> <span class="s">&quot;&lt;sequence&gt; [[[and] repeat [that]] &lt;n&gt; times]&quot;</span>
    <span class="n">extras</span>   <span class="o">=</span> <span class="p">[</span>
                <span class="n">sequence</span><span class="p">,</span>             <span class="c"># Sequence of actions defined above.</span>
                <span class="n">Integer</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">100</span><span class="p">),</span> <span class="c"># Times to repeat the sequence.</span>
               <span class="p">]</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;n&quot;</span><span class="p">:</span> <span class="mf">1</span><span class="p">,</span>               <span class="c"># Default repeat count.</span>
               <span class="p">}</span>

    <span class="c"># This method gets called when this rule is recognized.</span>
    <span class="c"># Arguments:</span>
    <span class="c">#  - node -- root node of the recognition parse tree.</span>
    <span class="c">#  - extras -- dict of the &quot;extras&quot; special elements:</span>
    <span class="c">#     . extras[&quot;sequence&quot;] gives the sequence of actions.</span>
    <span class="c">#     . extras[&quot;n&quot;] gives the repeat count.</span>
    <span class="k">def</span> <span class="nf">_process_recognition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">extras</span><span class="p">):</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">extras</span><span class="p">[</span><span class="s">&quot;sequence&quot;</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">extras</span><span class="p">[</span><span class="s">&quot;n&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>


<span class="c">#---------------------------------------------------------------------------</span>
<span class="c"># Create and load this module&#39;s grammar.</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="n">Grammar</span><span class="p">(</span><span class="s">&quot;multi edit&quot;</span><span class="p">)</span>   <span class="c"># Create this module&#39;s grammar.</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">RepeatRule</span><span class="p">())</span>    <span class="c"># Add the top-level rule.</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>                    <span class="c"># Load the grammar.</span>

<span class="c"># Unload function which will be called at unload time.</span>
<span class="k">def</span> <span class="nf">unload</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">grammar</span>
    <span class="k">if</span> <span class="n">grammar</span><span class="p">:</span> <span class="n">grammar</span><span class="o">.</span><span class="n">unload</span><span class="p">()</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</td></tr></table></div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference external" href="">Command-module for cursor movement and <strong>editing</strong></a><ul>
<li><a class="reference external" href="#example-commands">Example commands</a></li>
<li><a class="reference external" href="#module-source-code">Module source code</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="mod-_winctrl.html" title="previous chapter">Command-module for moving and controlling <strong>windows</strong></a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="mod-_taskbar.html" title="next chapter">Command-module for <strong>taskbar</strong> and icon tray access</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/mod-_multiedit.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="mod-_taskbar.html" title="Command-module for taskbar and icon tray access"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mod-_winctrl.html" title="Command-module for moving and controlling windows"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Dragonfly-modules v0.1 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2008, Christo Butcher.
      Last updated on Dec 06, 2008.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
    </div>
  </body>
</html>